


Order of execution for applying k8s files

make build-docker-images

kubectl create configmap zap-logger-config --from-file=../src/config/zap-logger-config.json
kubectl create configmap gorm-logger-config --from-file=../src/config/gorm-logger-config.json

kubectl apply -f all-configmap.yaml
kubectl create secret generic all-service-secret --from-env-file=.env_local
kubectl apply -f postgres-pvc.yaml
kubectl apply -f postgres-secret.yaml
kubectl apply -f postgres-configmap.yaml
kubectl apply -f postgres-deployment.yaml
kubectl apply -f postgres-service.yaml


kubectl apply -f point-deployment.yaml
kubectl apply -f point-service.yaml

kubectl apply -f department-deployment.yaml
kubectl apply -f department-service.yaml

kubectl apply -f user-deployment.yaml
kubectl apply -f user-service.yaml


--IP address of the node comes from here:
khalid@khalid-Latitude-7400:~$ kubectl get node -o wide
NAME       STATUS   ROLES           AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
minikube   Ready    control-plane   5m48s   v1.34.0   192.168.49.2   <none>        Ubuntu 22.04.5 LTS   6.8.0-88-generic   docker://28.4.0



--Ports come from here: 
khalid@khalid-Latitude-7400:~$ kubectl get svc
NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
db                   ClusterIP   10.100.27.61    <none>        5432/TCP         7m48s
department-service   NodePort    10.111.81.59    <none>        5002:32070/TCP   5m27s
kubernetes           ClusterIP   10.96.0.1       <none>        443/TCP          9m29s
point-service        ClusterIP   10.102.45.14    <none>        8185/TCP         5m41s
user-service         NodePort    10.104.90.175   <none>        5001:32748/TCP   5m13s




curl 192.168.49.2:32748/v1/users
curl 192.168.49.2:32070/v1/departments


minikube addons enable ingress
kubectl get pods -n ingress-nginx
kubectl apply -f nginx-ingress.yaml

khalid@khalid-Latitude-7400:~/p2/k8$ kubectl get ingress
NAME            CLASS   HOSTS         ADDRESS        PORTS   AGE
nginx-ingress   nginx   nginx.local   192.168.49.2   80      81s

--Add to /etc/hosts file
<MINIKUBE_IP>  nginx.local

minikube ip
192.168.49.2

http://nginx.local/v1/users
http://nginx.local/v1/departments

